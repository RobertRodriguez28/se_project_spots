!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disable",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?(console.log(e),t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)};function o(e,t,r="Save",o="Saving..."){t?(e.textContent=o,e.disabled=!0):(e.textContent=r,e.disabled=!1)}const n=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editUserInfo(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}addNewCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(e=>(e.ok||Promise.reject(`Error: ${e.status}`),e.json()))}changeLikeStatus(e,t){const r=t?"DELETE":"PUT";return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:r,headers:this._headers}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"4d19c944-b278-4711-8007-360473543820","Content-Type":"application/json"}}),a=document.querySelector(".profile__name"),s=document.querySelector(".profile__description"),c=document.querySelector("#card-template").content.querySelector(".card"),i=document.querySelector(".cards__lists"),l=document.querySelector(".profile__edit-btn"),d=document.querySelector("#edit-profile-modal"),u=d.querySelector(".modal__close-btn"),m=d.querySelector(".modal__form"),_=d.querySelector("#profile-name-input"),f=d.querySelector("#profile-description-input"),h=document.querySelector(".profile__add-btn"),v=document.querySelector("#new-post-modal"),S=v.querySelector(".modal__close-btn"),y=v.querySelector(".modal__form"),p=v.querySelector("#card-image-input"),b=v.querySelector("#profile-caption-input"),q=document.querySelector("#preview-modal"),E=(q.querySelector(".modal__close-btn"),q.querySelector(".modal__image-preview")),k=q.querySelector(".modal__caption"),L=document.querySelector(".profile__avatar-btn"),C=document.querySelector("#edit-avatar-modal"),g=C.querySelector(".modal__form"),$=(C.querySelector(".modal__submit-btn"),C.querySelector(".modal__close-btn")),j=C.querySelector("#profile-avatar-input"),U=document.querySelector(".profile__avatar"),x=document.querySelector("#delete-modal"),A=x.querySelector(".modal__button_type_delete"),P=x.querySelector(".modal__button_type_cancel"),I=x.querySelector(".modal__close-btn");function w(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&T(e)}}function D(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",w)}function T(e){e.classList.remove("modal_is-opened"),document.addEventListener("keydown",w)}let B,N;function O(e){const t=c.cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),a=t.querySelector(".card__like-button"),s=t.querySelector(".card__delete-button"),i=q.querySelector(".modal__close-btn");return s.addEventListener("click",()=>{B=e._id,N=t,D(x),s.addEventListener("click",()=>handleDeleteCard(t,e))}),i.addEventListener("click",()=>{T(q)}),o.addEventListener("click",()=>{E.src=e.link,k.textContent=e.name,D(q)}),o.src=e.link,o.alt=e.name,r.textContent=e.name,console.log(t),console.log(a),e.isLiked&&a.classList.add("card__like-button_active"),a.addEventListener("click",()=>{n.changeLikeStatus(e._id,e.isLiked).then(t=>{e.isLiked=t.isLiked,t.isLiked?a.classList.toggle("card__like-button_active"):a.classList.remove("card__like-button_active")}).catch(console.error)}),t}function J(){B=null,N=null}var H;document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&T(e)})}),l.addEventListener("click",function(){_.value=a.textContent,f.value=s.textContent,((e,o,n)=>{o.forEach(r=>{t(e,r,n)});const a=e.querySelector(n.submitButtonSelector);r(o,a,n)})(m,[_,f],e),D(d)}),m.addEventListener("submit",function(e){e.preventDefault();let t=e.submitter;o(t,!0,"Save","Saving"),n.editUserInfo(_.value,f.value).then(e=>{a.textContent=e.name,s.textContent=e.about}).catch(console.error).finally(()=>{o(t,!1)}),T(d),e.target.reset()}),u.addEventListener("click",function(){T(d)}),A.addEventListener("click",function(e){e.preventDefault(),n.deleteCard(B).then(()=>{T(x),N.remove()}).catch(e=>{console.error("Failed to delete card:",e)})}),n.getAppInfo().then(([e,t])=>{e.forEach(e=>{const t=O(e);i.append(t)});const r=document.querySelector(".profile__avatar");r&&(r.src=t.avatar),a.textContent=t.name,s.textContent=t.about}).catch(console.error),y.addEventListener("submit",function(t){t.preventDefault();let a=t.submitter;o(a,!0,"Save","Saving"),n.addNewCard(b.value,p.value).then(o=>{!function(e){const t=O(e);i.prepend(t)}(o),console.log(b.value),t.target.reset(),r([p,b],t.submitter,e)}).catch(e=>{console.err("Add new card:",e)}).finally(()=>{o(a,!1)}),T(v)}),h.addEventListener("click",function(){D(v)}),S.addEventListener("click",function(){T(v),p.value="",b.value=""}),L.addEventListener("click",()=>{D(C)}),$.addEventListener("click",function(){T(C)}),g.addEventListener("submit",function(e){e.preventDefault();let t=e.submitter;o(t,!0,"Save","Saving"),n.editAvatarInfo(j.value).then(({avatar:e})=>{U.src=e}).catch(e=>{console.error(e)}).finally(()=>{o(t,!1),T(C)})}),I.addEventListener("click",function(){T(x),J()}),P.addEventListener("click",function(){T(x),J()}),H=e,Array.from(document.querySelectorAll(H.formSelector)).forEach(e=>{((e,o)=>{const n=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r(n,a,o),n.forEach(s=>{s.addEventListener("input",function(){((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(o.inputErrorClass)})(e,r,r.validationMessage,o)})(e,s,o),r(n,a,o)})})})(e,H)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RSxTQUFTMEQsaUJBQWlCcEgsRUFBT1QsZUFDcEQ4SCxRQUFTdkgsSUFmTTJJLEVBQUMzSSxFQUFRRSxLQUNqQyxNQUFNTyxFQUFZZ0ksTUFBTUMsS0FBSzFJLEVBQU9zSCxpQkFBaUJwSCxFQUFPUixnQkFDdERnQixFQUFnQlYsRUFBT0csY0FBY0QsRUFBT1Asc0JBRWxEYSxFQUFrQkMsRUFBV0MsRUFBZVIsR0FFNUNPLEVBQVU4RyxRQUFTcUIsSUFDakJBLEVBQWEzQyxpQkFBaUIsUUFBUyxXQXpDaEI0QyxFQUFDN0ksRUFBUUMsRUFBU0MsS0FDdENELEVBQVFZLFNBQVNDLE1BR3BCZixFQUFlQyxFQUFRQyxFQUFTQyxHQWhCYjRJLEVBQUM5SSxFQUFRQyxFQUFTOEksRUFBVTdJLEtBQzlCRixFQUFPRyxjQUFjLElBQUlGLEVBQVFHLFlBQ3pDQyxZQUFjMEksRUFDekI5SSxFQUFRSyxVQUFVWSxJQUFJaEIsRUFBT0wsa0JBVzNCaUosQ0FBZTlJLEVBQVFDLEVBQVNBLEVBQVErSSxrQkFBbUI5SSxJQXdDekQySSxDQUFtQjdJLEVBQVE0SSxFQUFjMUksR0FDekNNLEVBQWtCQyxFQUFXQyxFQUFlUixFQUM5QyxNQU1BeUksQ0FBa0IzSSxFQUFRRSxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2Rpc2FibGVcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yXCIsXG59O1xuXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIGVycm9yTXNnLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gZXJyb3JNc2c7XG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xuICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICB9XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+IHtcbiAgICByZXR1cm4gIWlucHV0LnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGNvbnNvbGUubG9nKGlucHV0TGlzdCk7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcblxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG59O1xuXG5jb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgfSk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsLCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcbmNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn07XG5cbmV4cG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHNldHRpbmdzLCByZXNldFZhbGlkYXRpb24sIHRvZ2dsZUJ1dHRvblN0YXRlIH07XG4iLCJleHBvcnQgZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChcbiAgc3VibWl0YnRuLFxuICBpc0xvYWRpbmcsXG4gIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIlxuKSB7XG4gIGlmIChpc0xvYWRpbmcpIHtcbiAgICBzdWJtaXRidG4udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcbiAgICBzdWJtaXRidG4uZGlzYWJsZWQgPSB0cnVlO1xuICAgIC8vIHNldCB0aGUgbG9hZGluZyB0ZXh0XG4gIH0gZWxzZSB7XG4gICAgc3VibWl0YnRuLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XG4gICAgc3VibWl0YnRuLmRpc2FibGVkID0gZmFsc2U7XG4gICAgLy8gc2V0IHRoZSBsb2FkIHRleHRcbiAgfVxufVxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHNldHRpbmdzLFxuICByZXNldFZhbGlkYXRpb24sXG4gIHRvZ2dsZUJ1dHRvblN0YXRlLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcbmltcG9ydCB7IHNldEJ1dHRvblRleHQgfSBmcm9tIFwiLi4vdXRpbHMvaGVscGVycy5qc1wiO1xuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNGQxOWM5NDQtYjI3OC00NzExLTgwMDctMzYwNDczNTQzODIwXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuY29uc3QgcHJvZmlsZU5hbWVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbkVMID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcblxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnRcbiAgLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKVxuICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIik7XG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0c1wiKTtcbmFwaTtcblxuLy8gRWRpdFByb2ZpbGUgTW9kYWxcbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdG4gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlRm9ybUVMID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5cbi8vIE5ldyBQb3N0IE1vZGFsXG5jb25zdCBuZXdQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xuY29uc3QgbmV3UG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RDbG9zZUJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBuZXdQb3N0QnRuRm9ybUVsID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBuZXdQb3N0SW1hZ2VJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG5jb25zdCBuZXdQb3N0RGVzY3JpcHRpb25JbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWNhcHRpb24taW5wdXRcIlxuKTtcblxuLy8gUHJldmlld01vZGFsXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxDbG9zZUJ0biA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBwcmV2aWV3SW1hZ2VFbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZS1wcmV2aWV3XCIpO1xuY29uc3QgcHJldmlld0NhcHRpb25FTCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBBdmF0YXJNb2RhbFxuY29uc3QgYXZhdGFyTW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGF2YXRhclN1Ym1pdEJ0biA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBhdmF0YXJDbG9zZUJ0biA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGF2YXRhcklucHV0ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWF2YXRhci1pbnB1dFwiKTtcbmNvbnN0IGF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5cbi8vIERlbGV0ZU1vZGFsXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlQ29uZmlybUJ1dHRvbiA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19idXR0b25fdHlwZV9kZWxldGVcIlxuKTtcbmNvbnN0IGRlbGV0ZUNhbmNlbEJ1dHRvbiA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19idXR0b25fdHlwZV9jYW5jZWxcIlxuKTtcbmNvbnN0IGRlbGV0ZUNsb3NlQnV0dG9uID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuXG5mdW5jdGlvbiBoYW5kbGVFc2NhcGVLZXkoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjYXBlS2V5KTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVLZXkpO1xufVxuXG5jb25zdCBhbGxNb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xuYWxsTW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC50YXJnZXQgPT09IG1vZGFsKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gIH0pO1xufSk7XG5sZXQgc2VsZWN0ZWRDYXJkSWQ7XG5sZXQgc2VsZWN0ZWRDYXJkRWw7XG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZFRpdGxlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IGNhcmRMaWtlQnRuRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnRuRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG4gIGNvbnN0IGNhcmRQcmV2aWV3Q2xvc2VCdG4gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuXG4gIGNhcmREZWxldGVCdG5FbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHNlbGVjdGVkQ2FyZElkID0gZGF0YS5faWQ7XG4gICAgc2VsZWN0ZWRDYXJkRWwgPSBjYXJkRWxlbWVudDtcblxuICAgIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG4gICAgY2FyZERlbGV0ZUJ0bkVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YSlcbiAgICApO1xuICB9KTtcblxuICBjYXJkUHJldmlld0Nsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcblxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByZXZpZXdJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3Q2FwdGlvbkVMLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICBjb25zb2xlLmxvZyhjYXJkRWxlbWVudCk7XG4gIGNvbnNvbGUubG9nKGNhcmRMaWtlQnRuRWwpO1xuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdG5FbC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICB9XG4gIGNhcmRMaWtlQnRuRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBhcGlcbiAgICAgIC5jaGFuZ2VMaWtlU3RhdHVzKGRhdGEuX2lkLCBkYXRhLmlzTGlrZWQpXG4gICAgICAudGhlbigodXBkYXRlQ2FyZCkgPT4ge1xuICAgICAgICBkYXRhLmlzTGlrZWQgPSB1cGRhdGVDYXJkLmlzTGlrZWQ7XG4gICAgICAgIGlmICh1cGRhdGVDYXJkLmlzTGlrZWQpIHtcbiAgICAgICAgICBjYXJkTGlrZUJ0bkVsLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FyZExpa2VCdG5FbC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuICB9KTtcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5lZGl0UHJvZmlsZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQ7XG4gIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbkVMLnRleHRDb250ZW50O1xuICByZXNldFZhbGlkYXRpb24oXG4gICAgZWRpdFByb2ZpbGVGb3JtRUwsXG4gICAgW2VkaXRQcm9maWxlTmFtZUlucHV0LCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXRdLFxuICAgIHNldHRpbmdzXG4gICk7XG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGxldCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSwgXCJTYXZlXCIsIFwiU2F2aW5nXCIpO1xuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlLCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb25FTC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xuICAgIH0pO1xuXG4gIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG4gIGV2dC50YXJnZXQucmVzZXQoKTtcbn1cblxuZWRpdFByb2ZpbGVGb3JtRUwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XG5cbmVkaXRQcm9maWxlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5kZWxldGVDb25maXJtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgICAgIHNlbGVjdGVkQ2FyZEVsLnJlbW92ZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZGVsZXRlIGNhcmQ6XCIsIGVycik7XG4gICAgfSk7XG59KTtcblxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgdXNlckRhdGFdKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuICAgIGNvbnN0IGF2YXRhckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG4gICAgaWYgKGF2YXRhckVsKSBhdmF0YXJFbC5zcmMgPSB1c2VyRGF0YS5hdmF0YXI7XG4gICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XG4gICAgcHJvZmlsZURlc2NyaXB0aW9uRUwudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuZnVuY3Rpb24gcmVuZGVyQ2FyZChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoZGF0YSk7XG4gIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbn1cbmZ1bmN0aW9uIGhhbmRsZU5ld1Bvc3QoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBsZXQgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUsIFwiU2F2ZVwiLCBcIlNhdmluZ1wiKTtcbiAgYXBpXG4gICAgLmFkZE5ld0NhcmQobmV3UG9zdERlc2NyaXB0aW9uSW5wdXQudmFsdWUsIG5ld1Bvc3RJbWFnZUlucHV0LnZhbHVlKVxuICAgIC50aGVuKChjYXJkKSA9PiB7XG4gICAgICByZW5kZXJDYXJkKGNhcmQpO1xuICAgICAgY29uc29sZS5sb2cobmV3UG9zdERlc2NyaXB0aW9uSW5wdXQudmFsdWUpO1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoXG4gICAgICAgIFtuZXdQb3N0SW1hZ2VJbnB1dCwgbmV3UG9zdERlc2NyaXB0aW9uSW5wdXRdLFxuICAgICAgICBldnQuc3VibWl0dGVyLFxuICAgICAgICBzZXR0aW5nc1xuICAgICAgKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycihcIkFkZCBuZXcgY2FyZDpcIiwgZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbn1cbm5ld1Bvc3RCdG5Gb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVOZXdQb3N0KTtcbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgb3Blbk1vZGFsKG5ld1Bvc3RNb2RhbCk7XG59KTtcblxubmV3UG9zdENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbiAgbmV3UG9zdEltYWdlSW5wdXQudmFsdWUgPSBcIlwiO1xuICBuZXdQb3N0RGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IFwiXCI7XG59KTtcbi8vIEF2YXRhck1vZGFsIExvZ2ljXG5hdmF0YXJNb2RhbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJTdWJtaXQpO1xuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBsZXQgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUsIFwiU2F2ZVwiLCBcIlNhdmluZ1wiKTtcblxuICBhcGlcbiAgICAuZWRpdEF2YXRhckluZm8oYXZhdGFySW5wdXQudmFsdWUpXG4gICAgLnRoZW4oKHsgYXZhdGFyIH0pID0+IHtcbiAgICAgIGF2YXRhckltYWdlLnNyYyA9IGF2YXRhcjtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHJlc2V0RGVsZXRlU2VsZWN0aW9uKCkge1xuICBzZWxlY3RlZENhcmRJZCA9IG51bGw7XG4gIHNlbGVjdGVkQ2FyZEVsID0gbnVsbDtcbn1cbmRlbGV0ZUNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICByZXNldERlbGV0ZVNlbGVjdGlvbigpO1xufSk7XG5kZWxldGVDYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gIHJlc2V0RGVsZXRlU2VsZWN0aW9uKCk7XG59KTtcblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyhuYW1lLCBhYm91dCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuICBhZGROZXdDYXJkKG5hbWUsIGxpbmspIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKCFyZXMub2spIHtcbiAgICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpIHtcbiAgICBjb25zdCBtZXRob2QgPSBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCI7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gcmVtb3ZlTGlrZShpZCwgaXNMaWtlZCkge1xuICAvLyAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgLy8gICAgIG1ldGhvZDogXCJQVVRcIixcbiAgLy8gICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gIC8vICAgfSkudGhlbigocmVzKSA9PiB7XG4gIC8vICAgICBpZiAocmVzLm9rKSB7XG4gIC8vICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAvLyAgICAgfVxuICAvLyAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIC8vICAgfSk7XG4gIC8vIH1cbn1cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWwiLCJpbnB1dEVsIiwiY29uZmlnIiwicXVlcnlTZWxlY3RvciIsImlkIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJzb21lIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiY29uc29sZSIsImxvZyIsImFkZCIsImRpc2FibGVkIiwic2V0QnV0dG9uVGV4dCIsInN1Ym1pdGJ0biIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwibG9hZGluZ1RleHQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRBcHBJbmZvIiwiUHJvbWlzZSIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZGVsZXRlQ2FyZCIsImZldGNoIiwibWV0aG9kIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImVkaXRBdmF0YXJJbmZvIiwiYXZhdGFyIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0VXNlckluZm8iLCJuYW1lIiwiYWJvdXQiLCJhZGROZXdDYXJkIiwibGluayIsImNoYW5nZUxpa2VTdGF0dXMiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsInByb2ZpbGVOYW1lRWwiLCJkb2N1bWVudCIsInByb2ZpbGVEZXNjcmlwdGlvbkVMIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImNhcmRzTGlzdCIsImVkaXRQcm9maWxlQnRuIiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlQ2xvc2VCdG4iLCJlZGl0UHJvZmlsZUZvcm1FTCIsImVkaXRQcm9maWxlTmFtZUlucHV0IiwiZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwibmV3UG9zdEJ0biIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RDbG9zZUJ0biIsIm5ld1Bvc3RCdG5Gb3JtRWwiLCJuZXdQb3N0SW1hZ2VJbnB1dCIsIm5ld1Bvc3REZXNjcmlwdGlvbklucHV0IiwicHJldmlld01vZGFsIiwicHJldmlld0ltYWdlRWwiLCJwcmV2aWV3Q2FwdGlvbkVMIiwiYXZhdGFyTW9kYWxCdG4iLCJhdmF0YXJNb2RhbCIsImF2YXRhckZvcm0iLCJhdmF0YXJDbG9zZUJ0biIsImF2YXRhcklucHV0IiwiYXZhdGFySW1hZ2UiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUNvbmZpcm1CdXR0b24iLCJkZWxldGVDYW5jZWxCdXR0b24iLCJkZWxldGVDbG9zZUJ1dHRvbiIsImhhbmRsZUVzY2FwZUtleSIsImV2dCIsImtleSIsIm9wZW5lZE1vZGFsIiwiY2xvc2VNb2RhbCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiYWRkRXZlbnRMaXN0ZW5lciIsInNlbGVjdGVkQ2FyZElkIiwic2VsZWN0ZWRDYXJkRWwiLCJnZXRDYXJkRWxlbWVudCIsImRhdGEiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZUVsIiwiY2FyZEltYWdlRWwiLCJjYXJkTGlrZUJ0bkVsIiwiY2FyZERlbGV0ZUJ0bkVsIiwiY2FyZFByZXZpZXdDbG9zZUJ0biIsIl9pZCIsImhhbmRsZURlbGV0ZUNhcmQiLCJzcmMiLCJhbHQiLCJ1cGRhdGVDYXJkIiwidG9nZ2xlIiwiY2F0Y2giLCJlcnJvciIsInJlc2V0RGVsZXRlU2VsZWN0aW9uIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJ0YXJnZXQiLCJ2YWx1ZSIsInJlc2V0VmFsaWRhdGlvbiIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnRuIiwic3VibWl0dGVyIiwiZmluYWxseSIsInJlc2V0IiwiZXJyIiwiY2FyZHMiLCJ1c2VyRGF0YSIsIml0ZW0iLCJhcHBlbmQiLCJhdmF0YXJFbCIsImNhcmQiLCJwcmVwZW5kIiwicmVuZGVyQ2FyZCIsIkFycmF5IiwiZnJvbSIsInNldEV2ZW50TGlzdGVuZXJzIiwiaW5wdXRFbGVtZW50IiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsInZhbGlkYXRpb25NZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==